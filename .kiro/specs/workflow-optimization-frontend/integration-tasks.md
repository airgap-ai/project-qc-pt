# 工作流优化功能整合任务清单

## 任务概述

将已完成的独立工作流优化页面功能整合到现有的项目详情和任务中心页面中，提供更流畅的用户体验。

## 整合策略

根据整合方案（见 `integration-plan.md`），将独立页面的功能整合到现有页面：
- **项目详情页面**：文档管理、结构化内容、合规检查、数据比对、预警管理
- **任务中心**：人工校验优化、语义比对

## 任务列表

### 阶段 1: 项目详情页面增强（优先级：高）

#### 1.1 文档管理增强
**目标**: 将 `document-upload.html` 的功能整合到项目详情页面

- [x] 在 `project-detail.html` 文档清单区域添加"上传文档"按钮
- [x] 创建文档上传模态框组件
  - [x] 实现拖拽上传区域
  - [x] 实现点击上传功能
  - [x] 实现文件格式验证（Excel/Word/PDF）
  - [x] 实现文件大小限制（50MB）
  - [x] 实现上传进度显示
- [x] 添加"从生产管理系统同步"按钮
  - [x] 实现同步进度显示
  - [x] 实现同步结果反馈
- [ ] 更新文档列表展示
  - [ ] 显示文档来源（上传/同步）
  - [ ] 显示文档状态
  - [ ] 添加文档操作按钮（查看/删除/重新上传）

**验收标准**:
- 用户可以在项目详情页面直接上传文档 ✓
- 上传过程有清晰的进度反馈 ✓
- 文档列表实时更新（待实现）

**实施说明**:
- 已在项目详情页面标题栏添加"上传文档"和"同步文档"按钮
- 已创建文档上传模态框，支持拖拽和点击上传
- 已实现文件格式验证（Excel/Word/PDF）和大小限制（50MB）
- 已实现上传和提取进度模拟
- 已在 `interactions.js` 中添加完整的文档上传交互逻辑
- 文档列表的动态更新需要进一步整合到现有的静态文档列表中

#### 1.2 结构化内容展示
**目标**: 将 `structured-content.html` 的内容整合到项目详情页面

- [ ] 扩展右侧"项目关键信息"面板
  - [ ] 添加"详细信息"折叠区域
  - [ ] 实现标签页切换（金额/进度/交付物/人员）
- [ ] 整合项目金额与付款信息
  - [ ] 显示基本金额信息（含税价格、税率等）
  - [ ] 显示付款条件列表
  - [ ] 添加数据来源标注
  - [ ] 实现字段编辑功能
- [ ] 整合项目进度时间轴
  - [ ] 显示关键时间节点
  - [ ] 实现时间轴可视化
  - [ ] 支持时间节点调整
- [ ] 整合交付成果展示
  - [ ] 按阶段分组显示交付物
  - [ ] 显示交付物状态
  - [ ] 支持交付物管理（添加/编辑/删除）
- [ ] 整合人员要求对比
  - [ ] 显示人员要求
  - [ ] 显示实际配置
  - [ ] 标注差异

**验收标准**:
- 项目详细信息在右侧面板中清晰展示
- 信息分类合理，易于查找
- 支持快速编辑和更新

#### 1.3 合规性检查集成
**目标**: 将 `compliance-check.html` 的功能整合到项目详情页面

- [ ] 在文档清单下方添加"合规性检查"折叠区域
  - [ ] 添加统计卡片（总问题数、高风险、中风险、低风险）
  - [ ] 实现问题列表展示
  - [ ] 实现红色高亮显示问题项
- [ ] 添加问题操作按钮
  - [ ] "标记为已知"按钮
  - [ ] "去校验"按钮（跳转任务中心）
  - [ ] "查看详情"按钮
- [ ] 实现问题筛选和排序
  - [ ] 按风险级别筛选
  - [ ] 按状态筛选
  - [ ] 按时间排序
- [ ] 添加导出功能
  - [ ] 导出合规性检查报告

**验收标准**:
- 合规性问题在项目详情页面清晰可见
- 用户可以快速处理问题
- 问题状态实时更新

### 阶段 2: 数据验证功能（优先级：中）

#### 2.1 数据比对模块
**目标**: 将 `data-comparison.html` 的功能整合到项目详情页面

- [ ] 在项目信息区域添加"数据比对"按钮
- [ ] 创建数据比对模态框
  - [ ] 实现标签页切换（金额/进度/交付物/人员）
  - [ ] 实现金额比对展示
  - [ ] 实现进度比对展示
  - [ ] 实现交付物比对展示
  - [ ] 实现人员比对展示
- [ ] 添加差异标注功能
  - [ ] 高亮显示差异项
  - [ ] 显示差异详情
  - [ ] 提供差异说明
- [ ] 添加实时状态显示
  - [ ] 显示比对状态（正常/异常）
  - [ ] 显示比对时间
  - [ ] 显示数据来源
- [ ] 添加导出功能
  - [ ] 导出比对报告

**验收标准**:
- 数据比对结果清晰易懂
- 差异项明显标注
- 支持导出报告

#### 2.2 预警管理
**目标**: 将 `alert-management.html` 的功能整合到项目详情页面和通知系统

- [ ] 在项目详情页面顶部添加预警横幅
  - [ ] 显示当前项目的预警信息
  - [ ] 使用颜色标识预警级别（黄色/橙色/红色）
  - [ ] 提供快速操作按钮
- [ ] 在右侧添加"项目预警"卡片
  - [ ] 显示预警统计
  - [ ] 显示最近预警列表
  - [ ] 提供"查看全部"链接
- [ ] 创建预警详情模态框
  - [ ] 显示预警详细信息
  - [ ] 显示预警历史
  - [ ] 提供处理操作（标记已处理/忽略）
- [ ] 实现预警筛选功能
  - [ ] 按级别筛选
  - [ ] 按类型筛选
  - [ ] 按状态筛选
- [ ] 整合到通知系统
  - [ ] 在通知面板中显示预警
  - [ ] 支持多渠道通知设置

**验收标准**:
- 预警信息及时显示
- 预警级别清晰标识
- 用户可以快速处理预警

### 阶段 3: 任务中心增强（优先级：中）

#### 3.1 人工校验优化
**目标**: 将优化后的 `hitl-workbench.html` 功能整合到任务中心

- [ ] 在任务详情中添加"打开校验工作台"按钮
- [ ] 创建校验工作台模态框
  - [ ] 显示文档预览
  - [ ] 显示字段列表
  - [ ] 实现字段点击高亮文档区域
  - [ ] 实现字段编辑功能
- [ ] 实现自动标记功能
  - [ ] 修改后自动标记"已人工校验"
  - [ ] 显示校验状态
- [ ] 添加修改历史记录
  - [ ] 记录每次修改
  - [ ] 显示修改时间和操作人
  - [ ] 支持查看历史版本
- [ ] 添加快捷键支持
  - [ ] 快速切换字段
  - [ ] 快速保存
  - [ ] 快速提交

**验收标准**:
- 校验工作台操作流畅
- 字段和文档联动准确
- 修改历史完整记录

#### 3.2 语义比对
**目标**: 将 `semantic-matching.html` 的功能整合到任务中心

- [ ] 在任务列表中添加"字段映射"任务类型
- [ ] 创建语义比对模态框
  - [ ] 显示待映射字段列表
  - [ ] 显示 AI 相似度分析结果
  - [ ] 标注相似度超过 80% 的项
- [ ] 实现用户确认功能
  - [ ] "是同一交付物"按钮
  - [ ] "不是同一交付物"按钮
  - [ ] "手动建立映射"功能
- [ ] 实现映射关系管理
  - [ ] 显示已建立的映射关系
  - [ ] 支持编辑映射关系
  - [ ] 支持删除映射关系
- [ ] 添加批量操作功能
  - [ ] 批量确认
  - [ ] 批量拒绝
  - [ ] 批量导入
- [ ] 添加导出功能
  - [ ] 导出映射表

**验收标准**:
- 语义比对结果准确
- 用户确认流程简单
- 映射关系管理方便

### 阶段 4: 代码整合与优化

#### 4.1 JavaScript 模块化
**目标**: 整合 `interactions-workflow.js` 到 `interactions.js`

- [ ] 分析 `interactions-workflow.js` 的功能模块
- [ ] 提取可复用的函数
  - [ ] 文档上传相关函数
  - [ ] 数据比对相关函数
  - [ ] 语义匹配相关函数
  - [ ] 预警管理相关函数
- [ ] 整合到 `interactions.js`
  - [ ] 按功能模块组织代码
  - [ ] 添加命名空间避免冲突
  - [ ] 优化代码结构
- [ ] 创建统一的模态框管理器
  - [ ] 管理所有模态框的打开/关闭
  - [ ] 处理模态框层级
  - [ ] 处理模态框动画
- [ ] 优化性能
  - [ ] 减少 DOM 操作
  - [ ] 使用事件委托
  - [ ] 延迟加载非关键功能

**验收标准**:
- 代码结构清晰
- 功能模块化
- 性能优化明显

#### 4.2 组件提取
**目标**: 创建可复用的 UI 组件

- [ ] 提取文档上传组件
  - [ ] 创建独立的上传组件函数
  - [ ] 支持配置选项
  - [ ] 提供回调接口
- [ ] 提取数据比对组件
  - [ ] 创建比对卡片组件
  - [ ] 创建差异标注组件
  - [ ] 创建状态指示器组件
- [ ] 提取语义匹配组件
  - [ ] 创建相似度显示组件
  - [ ] 创建映射关系组件
  - [ ] 创建批量操作组件
- [ ] 提取预警卡片组件
  - [ ] 创建预警横幅组件
  - [ ] 创建预警列表组件
  - [ ] 创建预警详情组件

**验收标准**:
- 组件可复用
- 接口清晰
- 易于维护

#### 4.3 文件清理
**目标**: 清理不再需要的独立页面文件

- [ ] 备份独立页面文件
  - [ ] 创建 `frontend/archived/` 目录
  - [ ] 移动独立页面到归档目录
- [ ] 移动以下文件到归档目录
  - [ ] `document-upload.html`
  - [ ] `structured-content.html`
  - [ ] `compliance-check.html`
  - [ ] `data-comparison.html`
  - [ ] `semantic-matching.html`
  - [ ] `alert-management.html`
- [ ] 保留 `interactions-workflow.js` 作为参考
  - [ ] 添加注释说明已整合
  - [ ] 移动到归档目录
- [ ] 更新导航链接
  - [ ] 移除指向独立页面的链接
  - [ ] 更新相关文档

**验收标准**:
- 独立页面已归档
- 导航链接已更新
- 功能无损失

## 完成状态

- **阶段 1**: 33% (1/3 任务完成)
  - ✓ 1.1 文档管理增强（核心功能已完成）
  - ⏳ 1.2 结构化内容展示
  - ⏳ 1.3 合规性检查集成
- **阶段 2**: 0% (0/2 任务完成)
- **阶段 3**: 0% (0/2 任务完成)
- **阶段 4**: 0% (0/3 任务完成)

**总体进度**: 10% (1/10 主要任务完成)

## 验收标准

### 功能完整性
- [ ] 所有原有功能都已整合
- [ ] 数据流正确无误
- [ ] 交互逻辑完整
- [ ] 无功能缺失

### 用户体验
- [ ] 操作流程顺畅
- [ ] 页面加载快速
- [ ] 响应式设计良好
- [ ] 减少页面跳转
- [ ] 信息层次清晰

### 代码质量
- [ ] 代码结构清晰
- [ ] 组件可复用
- [ ] 注释完整
- [ ] 无冗余代码
- [ ] 遵循设计系统规范

### 兼容性
- [ ] 与现有功能无冲突
- [ ] 浏览器兼容性良好
- [ ] 移动端适配
- [ ] 性能优化

## 时间估算

- **阶段 1**: 2-3 天
  - 文档管理增强: 1 天
  - 结构化内容展示: 1 天
  - 合规性检查集成: 0.5 天
- **阶段 2**: 1-2 天
  - 数据比对模块: 1 天
  - 预警管理: 0.5-1 天
- **阶段 3**: 1-2 天
  - 人工校验优化: 1 天
  - 语义比对: 0.5-1 天
- **阶段 4**: 1 天
  - JavaScript 模块化: 0.5 天
  - 组件提取: 0.3 天
  - 文件清理: 0.2 天
- **测试和优化**: 1 天

**总计**: 6-9 天

## 下一步行动

1. ✅ 完成签字检测功能移除
2. ✅ 创建整合方案文档
3. ✅ 创建整合任务清单
4. ⏳ 审查并确认整合方案
5. ⏳ 开始实施阶段 1 - 文档管理增强
6. ⏳ 逐步迭代和优化
7. ⏳ 完成后清理独立页面

## 参考文档

- `integration-plan.md` - 详细的整合方案
- `design.md` - 原始设计文档
- `tasks.md` - 原始任务清单
- 现有页面：`project-detail.html`, `task-center.html`
- 独立页面：`document-upload.html`, `structured-content.html` 等
